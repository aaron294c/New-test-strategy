//@version=6
// =================================================================
// RSI Chebyshev Pro with Leading Signals - Non-Repaint Base
// =================================================================
// © 2025 NPR21 (TradingView: @NPR21)
// All Rights Reserved
//
// LEADING SIGNAL SYSTEM:
// Standard signals: Wait for N bars confirmation (100% reliable, delayed)
// Leading signals: Fire 1 bar earlier using predictive detection
//
// HOW LEADING SIGNALS WORK:
// Instead of waiting for N bars on BOTH sides of a pivot, we:
// 1. Confirm N bars on the LEFT side (we have this data)
// 2. Detect momentum reversal on current bar (predictive)
// 3. Require RSI to be in extreme zone (context filter)
// 4. Require reversal candle pattern (confirmation)
//
// This fires at the ACTUAL pivot bar instead of N bars later.
// ~70-80% of these will become confirmed fractals.
// The 20-30% that fail would have been filtered anyway.
//
// =================================================================

indicator("RSI Chebyshev Pro v2 - Leading Signals [NPR21]",
     shorttitle="RSI Cheby Leading",
     overlay=false,
     max_labels_count=500)

// =================================================================
// Input Parameters - RSI
// =================================================================
colorBars = input.bool(false, "Color Bars",
                      group="RSI Settings")

styleChoice = input.string("Candle Trend", "Style",
                options=["Candle", "Candle Trend"],
                group="RSI Settings")

colorRsiLine = input.bool(false, "Color RSI Line",
                         group="RSI Settings")

rsiLineWidth = input.int(2, "RSI Line Width",
                         minval=1, maxval=10,
                         group="RSI Settings")

length = input.int(24, "Length",
                  minval=1,
                  group="RSI Settings")

smoothing = input.int(3, "Smoothing",
                     minval=1,
                     group="RSI Settings")

autoMovAvg = input.bool(true, "Auto MA",
                       group="RSI Settings")

movAvgMultiplier = input.int(1, "MA Multiplier",
                            minval=1,
                            group="RSI Settings")

maLineWidth = input.int(2, "MA Line Width",
                        minval=1, maxval=10,
                        group="RSI Settings")

// =================================================================
// Input Parameters - Fractals
// =================================================================
n = input.int(title="Fractal Periods (n)",
             defval=5, minval=2,
             group="Fractals")

showLabels = input.bool(title="Show BUY/SELL Labels",
                       defval=true,
                       group="Fractals")

showShapes = input.bool(title="Show Fractal Shapes",
                       defval=false,
                       group="Fractals")

buyOffsetTicks = input.int(title="BUY offset (ticks)",
                          defval=8, minval=0,
                          group="Fractals")

sellOffsetTicks = input.int(title="SELL offset (ticks)",
                           defval=8, minval=0,
                           group="Fractals")

buyLabelBgColor = input.color(title="BUY label background",
                             defval=#2962FF,
                             group="Fractals")

sellLabelBgColor = input.color(title="SELL label background",
                              defval=#DD0000,
                              group="Fractals")

buyTextColor = input.color(title="BUY text color",
                          defval=color.white,
                          group="Fractals")

sellTextColor = input.color(title="SELL text color",
                           defval=#FFFF00,
                           group="Fractals")

labelSizeOpt = input.string(title="Label size",
                           defval="normal",
                           options=["tiny","small","normal",
                                    "large","huge"],
                           group="Fractals")

// =================================================================
// LEADING SIGNAL CONTROLS
// =================================================================
enableLeadingSignals = input.bool(true, "Enable Leading Signals (1 Bar Earlier)",
                                  tooltip="Fire signals at potential pivot point instead of waiting for confirmation. More responsive but ~20-30% may not confirm.",
                                  group="LEADING SIGNALS")

leadingOversold = input.float(35.0, "Oversold Zone (BUY)",
                              minval=10, maxval=50,
                              tooltip="RSI must be below this level for leading BUY signals",
                              group="LEADING SIGNALS")

leadingOverbought = input.float(65.0, "Overbought Zone (SELL)",
                                minval=50, maxval=90,
                                tooltip="RSI must be above this level for leading SELL signals",
                                group="LEADING SIGNALS")

requireReversalCandle = input.bool(true, "Require Reversal Candle",
                                   tooltip="Require bullish/bearish candle pattern for leading signals",
                                   group="LEADING SIGNALS")

showLeadingOnly = input.bool(false, "Show ONLY Leading Signals",
                             tooltip="Hide standard confirmed signals, show only leading signals",
                             group="LEADING SIGNALS")

leadingLabelBgColorBuy = input.color(title="Leading BUY background",
                                     defval=#00E676,
                                     group="LEADING SIGNALS")

leadingLabelBgColorSell = input.color(title="Leading SELL background",
                                      defval=#FF5252,
                                      group="LEADING SIGNALS")

lblSize = switch labelSizeOpt
    "tiny" => size.tiny
    "small" => size.small
    "normal" => size.normal
    "large" => size.large
    => size.huge

// =================================================================
// Helper Functions
// =================================================================

mamaPeriod(float src, float dynLow, float dynHigh) =>
    var float period = 0.0
    float C1 = 0.0962
    float C2 = 0.5769
    float C3 = 0.075 * nz(period[1]) + 0.54
    float smooth = (4 * src + 3 * nz(src[1]) +
                   2 * nz(src[2]) + nz(src[3])) / 10
    float detrend = C3 * (C1 * smooth + C2 * nz(smooth[2]) -
                   C2 * nz(smooth[4]) - C1 * nz(smooth[6]))

    float Q1 = C3 * (C1 * detrend + C2 * nz(detrend[2]) -
              C2 * nz(detrend[4]) - C1 * nz(detrend[6]))
    float I1 = nz(detrend[3])

    float jI = C3 * (C1 * I1 + C2 * nz(I1[2]) -
              C2 * nz(I1[4]) - C1 * nz(I1[6]))
    float jQ = C3 * (C1 * Q1 + C2 * nz(Q1[2]) -
              C2 * nz(Q1[4]) - C1 * nz(Q1[6]))

    float I2_temp = I1 - jQ
    float Q2_temp = Q1 + jI

    var float I2 = 0.0
    var float Q2 = 0.0
    I2 := 0.2 * I2_temp + 0.8 * nz(I2[1])
    Q2 := 0.2 * Q2_temp + 0.8 * nz(Q2[1])

    float Re_temp = I2 * nz(I2[1]) + Q2 * nz(Q2[1])
    float Im_temp = I2 * nz(Q2[1]) - Q2 * nz(I2[1])
    var float Re = 0.0
    var float Im = 0.0
    Re := 0.2 * Re_temp + 0.8 * nz(Re[1])
    Im := 0.2 * Im_temp + 0.8 * nz(Im[1])

    float period1 = Re != 0 and Im != 0 ?
                   2 * math.pi / math.atan(Im/Re) : 0
    float period2 = math.min(period1, 1.5 * nz(period[1]))
    float period3 = math.max(period2, (2/3) * nz(period[1]))
    float period4 = math.min(math.max(period3, dynLow), dynHigh)

    period := period4 * 0.2 + nz(period[1]) * 0.8
    period

dma(float source) =>
    var float ema1 = source
    var float ema2 = source
    var int count = 0

    count += 1
    ema1 := (1.0 - 2.0 / (count + 1)) * ema1 + 2.0 / (count + 1) * source
    ema2 := (1.0 - 2.0 / (count + 1)) * ema2 + 2.0 / (count + 1) * ema1

    2 * ema1 - ema2

cosh(float x) => (math.exp(x) + math.exp(-x)) / 2
sinh(float x) => (math.exp(x) - math.exp(-x)) / 2
asinh(float x) => math.log(x + math.sqrt(x * x + 1))
acosh(float x) => x < 1 ? 1 :
                 math.log(x + math.sqrt(x * x - 1))

chebyshevI(float src, float len, float ripple) =>
    float alpha = 1 / len
    float acoshRi = 1 / (1 - ripple)
    float asinhRi = 1 / ripple
    float acosh_val = acosh(acoshRi)
    float asinh_val = asinh(asinhRi)
    float a = cosh(alpha * acosh_val)
    float b = sinh(alpha * asinh_val)
    float g = (a - b) / (a + b)

    var float chebyshev = src
    chebyshev := (1 - g) * src + g * nz(chebyshev[1])
    chebyshev

getLength(float source, int harmonic) =>
    float mama = mamaPeriod(source[1], 1, 2048)
    int cycle = math.round(mama)
    int cycles = na(cycle) ? 1 : cycle
    int max_cycle = (cycles + 1) * harmonic
    max_cycle

customRSI(float source, int rsi_length, int rsi_smoothing) =>
    float close_filtered = chebyshevI(source, rsi_smoothing, 0.5)
    float change = close_filtered - nz(close_filtered[1])
    float up = math.max(change, 0)
    float down = -math.min(change, 0)
    float up_filtered = chebyshevI(up, rsi_length, 0.5)
    float down_filtered = chebyshevI(down, rsi_length, 0.5)
    float rsi = down_filtered == 0 ? 100 :
               100 - (100 / (1 + up_filtered / down_filtered))
    rsi

patterns(float o, float h, float l, float c,
        float ohlc, float ma) =>
    bool c_down_trend = ohlc < ma
    bool c_up_trend = ohlc > ma
    bool rsi_low = h < 40
    bool rsi_high = l > 60

    float c_body_hi = math.max(c, o)
    float c_body_lo = math.min(c, o)
    float c_body = c_body_hi - c_body_lo
    float c_body_avg = dma(c_body)
    float c_body_middle = c_body / 2 + c_body_lo

    bool c_small_body = c_body < c_body_avg
    bool c_long_body = c_body > c_body_avg
    bool c_white_body = o < c
    bool c_black_body = o > c

    bool c_engulfing_bearish = c_up_trend and c_black_body and
         c_long_body and c_white_body[1] and c_small_body[1] and
         c <= o[1] and o >= c[1] and (c < o[1] or o > c[1]) and
         rsi_high

    bool c_engulfing_bullish = c_down_trend and c_white_body and
         c_long_body and c_black_body[1] and c_small_body[1] and
         c >= o[1] and o <= c[1] and (c > o[1] or o < c[1]) and
         rsi_low

    bool c_morning_star = false
    bool c_evening_star = false

    if c_long_body[2] and c_small_body[1] and c_long_body
        c_morning_star := c_down_trend and c_black_body[2] and
             c_white_body and c >= c_body_middle[2] and rsi_low

        c_evening_star := c_up_trend and c_white_body[2] and
             c_black_body and c <= c_body_middle[2] and rsi_high

    [c_engulfing_bearish, c_engulfing_bullish,
     c_morning_star, c_evening_star]

// =================================================================
// Main RSI Calculations - Using confirmed (closed) bars
// =================================================================

rsi_open = customRSI(open[1], length, smoothing)
rsi_high = customRSI(high[1], length, smoothing)
rsi_low = customRSI(low[1], length, smoothing)
rsi_close = customRSI(close[1], length, smoothing)

float OHLC = (rsi_close + rsi_open + rsi_high + rsi_low) / 4

int ma_length = getLength(OHLC, movAvgMultiplier)
float aema = chebyshevI(OHLC, ma_length, 0.05)

[engulfing_bearish, engulfing_bullish,
 morning_star_bullish, evening_star_bearish] =
     patterns(rsi_open, rsi_high, rsi_low, rsi_close, OHLC, aema)

// =================================================================
// Standard Fractals (Non-Repainting, Delayed)
// =================================================================
upPivot = ta.pivothigh(rsi_high, n, n)
downPivot = ta.pivotlow(rsi_low, n, n)

upFractal = not na(upPivot)
downFractal = not na(downPivot)

// =================================================================
// LEADING SIGNAL DETECTION
// =================================================================
// Detects potential pivots 1 bar earlier using:
// 1. N bars on LEFT side confirm potential pivot
// 2. Current bar in extreme RSI zone
// 3. Momentum reversal detected (RSI turning)
// 4. Optional: Reversal candle pattern

// Check if current bar's RSI low is lowest in last N bars (potential bottom)
isPotentialLow() =>
    bool isLowest = true
    for i = 1 to n
        if rsi_low[i] <= rsi_low
            isLowest := false
            break
    isLowest

// Check if current bar's RSI high is highest in last N bars (potential top)
isPotentialHigh() =>
    bool isHighest = true
    for i = 1 to n
        if rsi_high[i] >= rsi_high
            isHighest := false
            break
    isHighest

// RSI momentum reversal detection
rsiMomentum = rsi_close - rsi_close[1]
rsiMomentumPrev = rsi_close[1] - rsi_close[2]

// Bullish reversal: RSI was falling, now rising
bullishMomentumShift = rsiMomentumPrev < 0 and rsiMomentum > 0

// Bearish reversal: RSI was rising, now falling
bearishMomentumShift = rsiMomentumPrev > 0 and rsiMomentum < 0

// RSI candle reversal patterns
bullishRsiCandle = rsi_close > rsi_open  // Green RSI candle
bearishRsiCandle = rsi_close < rsi_open  // Red RSI candle

// Strong reversal: Large wick rejection
lowerWick = rsi_open > rsi_close ? rsi_close - rsi_low : rsi_open - rsi_low
upperWick = rsi_open > rsi_close ? rsi_high - rsi_open : rsi_high - rsi_close
bodySize = math.abs(rsi_close - rsi_open)

bullishWickRejection = lowerWick > bodySize * 1.5  // Long lower wick
bearishWickRejection = upperWick > bodySize * 1.5  // Long upper wick

// =================================================================
// LEADING SIGNAL CONDITIONS
// =================================================================

// Leading BUY Signal:
// - RSI in oversold zone
// - Current bar is potential low (lowest in N bars)
// - Momentum shifting bullish OR bullish candle
// - Optional: reversal candle pattern
leadingBuyBase = enableLeadingSignals and
                 rsi_low < leadingOversold and
                 isPotentialLow() and
                 (bullishMomentumShift or bullishRsiCandle or bullishWickRejection)

leadingBuySignal = requireReversalCandle ?
                   (leadingBuyBase and (bullishRsiCandle or bullishWickRejection)) :
                   leadingBuyBase

// Leading SELL Signal:
// - RSI in overbought zone
// - Current bar is potential high (highest in N bars)
// - Momentum shifting bearish OR bearish candle
// - Optional: reversal candle pattern
leadingSellBase = enableLeadingSignals and
                  rsi_high > leadingOverbought and
                  isPotentialHigh() and
                  (bearishMomentumShift or bearishRsiCandle or bearishWickRejection)

leadingSellSignal = requireReversalCandle ?
                    (leadingSellBase and (bearishRsiCandle or bearishWickRejection)) :
                    leadingSellBase

// Prevent duplicate signals (don't fire if we just had one)
var int lastLeadingBuyBar = 0
var int lastLeadingSellBar = 0

leadingBuyFinal = leadingBuySignal and (bar_index - lastLeadingBuyBar) > n
leadingSellFinal = leadingSellSignal and (bar_index - lastLeadingSellBar) > n

if leadingBuyFinal
    lastLeadingBuyBar := bar_index

if leadingSellFinal
    lastLeadingSellBar := bar_index

// =================================================================
// Plotting
// =================================================================

float col_val = OHLC > 65 ? 255 : OHLC < 35 ? 0 : OHLC * 2.55
color grad_color = color.rgb(255 - col_val, col_val, 0)

color upCandleColor = #00FF00
color dnCandleColor = color.rgb(239, 83, 80)

bool isTrendStyle = styleChoice == "Candle Trend"
bool up = rsi_close > rsi_open

// CANDLE TREND: Hollow green (bullish), Solid red (bearish)
plotcandle(isTrendStyle and up ? rsi_open : na,
           isTrendStyle and up ? rsi_high : na,
           isTrendStyle and up ? rsi_low : na,
           isTrendStyle and up ? rsi_close : na,
           "Trend Up Candle",
           na,
           wickcolor=upCandleColor,
           bordercolor=upCandleColor)

plotcandle(isTrendStyle and not up ? rsi_open : na,
           isTrendStyle and not up ? rsi_high : na,
           isTrendStyle and not up ? rsi_low : na,
           isTrendStyle and not up ? rsi_close : na,
           "Trend Down Candle",
           dnCandleColor,
           wickcolor=dnCandleColor,
           bordercolor=dnCandleColor)

// CANDLE: All solid
plotcandle(not isTrendStyle and up ? rsi_open : na,
           not isTrendStyle and up ? rsi_high : na,
           not isTrendStyle and up ? rsi_low : na,
           not isTrendStyle and up ? rsi_close : na,
           "Up Candle",
           upCandleColor,
           wickcolor=upCandleColor,
           bordercolor=upCandleColor)

plotcandle(not isTrendStyle and not up ? rsi_open : na,
           not isTrendStyle and not up ? rsi_high : na,
           not isTrendStyle and not up ? rsi_low : na,
           not isTrendStyle and not up ? rsi_close : na,
           "Down Candle",
           dnCandleColor,
           wickcolor=dnCandleColor,
           bordercolor=dnCandleColor)

plot(autoMovAvg ? aema : na, "MA", grad_color, linewidth=maLineWidth)

hline(70, "Overbought", color.gray, hline.style_dashed)
hline(50, "Midline", color.gray, hline.style_dashed)
hline(30, "Oversold", color.gray, hline.style_dashed)

// Leading signal zones
hline(leadingOverbought, "Leading OB Zone", color.new(color.red, 70), hline.style_dotted)
hline(leadingOversold, "Leading OS Zone", color.new(color.green, 70), hline.style_dotted)

// Pattern vertical lines
if engulfing_bullish and isTrendStyle
    line.new(bar_index, 0, bar_index, 100,
            color=color.new(#00FF00, 0),
            style=line.style_dashed, width=1)

if morning_star_bullish and isTrendStyle
    line.new(bar_index, 0, bar_index, 100,
            color=color.new(#00FF00, 0),
            style=line.style_dashed, width=1)

if engulfing_bearish and isTrendStyle
    line.new(bar_index, 0, bar_index, 100,
            color=color.new(#FF0000, 0),
            style=line.style_dashed, width=1)

if evening_star_bearish and isTrendStyle
    line.new(bar_index, 0, bar_index, 100,
            color=color.new(#FF0000, 0),
            style=line.style_dashed, width=1)

// Engulfing patterns
plotshape(engulfing_bullish and isTrendStyle ? -8 : na,
     "Eng Bull",
     shape.triangleup, location.absolute,
     color.new(#00FF00, 0), text="Eng",
     textcolor=color.white, size=size.small)

plotshape(engulfing_bearish and isTrendStyle ? rsi_high + 8 : na,
     "Eng Bear",
     shape.triangledown, location.absolute,
     color.new(#FF0000, 0), text="Eng",
     textcolor=color.white, size=size.small)

// Morning Star
plotshape(morning_star_bullish and isTrendStyle ? -8 : na,
     "Morn Star Diamond",
     shape.diamond, location.absolute,
     color.new(#00FF00, 0), size=size.small)

plotshape(morning_star_bullish and isTrendStyle ? -8 : na,
     "Morn Star Label",
     shape.labelup, location.absolute,
     color.new(#00FF00, 0), text="Morn Star",
     textcolor=color.black, size=size.small)

plotshape(morning_star_bullish and isTrendStyle ? -16 : na,
     "Morn Star Arrow",
     shape.arrowup, location.absolute,
     color.new(#00FF00, 0), size=size.large)

// Evening Star
plotshape(evening_star_bearish and isTrendStyle ? rsi_high + 8 : na,
     "Eve Star Diamond",
     shape.diamond, location.absolute,
     color.new(#FF0000, 0), size=size.small)

plotshape(evening_star_bearish and isTrendStyle ? rsi_high + 8 : na,
     "Eve Star Label",
     shape.labeldown, location.absolute,
     color.new(#FF0000, 0), text="Eve Star",
     textcolor=color.white, size=size.small)

plotshape(evening_star_bearish and isTrendStyle ? rsi_high + 16 : na,
     "Eve Star Arrow",
     shape.arrowdown, location.absolute,
     color.new(#FF0000, 0), size=size.large)

// =================================================================
// STANDARD FRACTAL LABELS (Delayed but confirmed)
// =================================================================
if showLabels and downFractal and not showLeadingOnly
    label.new(bar_index - n,
             rsi_low[n] - buyOffsetTicks, "BUY",
             xloc=xloc.bar_index, yloc=yloc.price,
             style=label.style_label_up,
             color=buyLabelBgColor, textcolor=buyTextColor,
             size=lblSize)

if showLabels and upFractal and not showLeadingOnly
    label.new(bar_index - n,
             rsi_high[n] + sellOffsetTicks, "SELL",
             xloc=xloc.bar_index, yloc=yloc.price,
             style=label.style_label_down,
             color=sellLabelBgColor, textcolor=sellTextColor,
             size=lblSize)

// Standard fractal shapes
if showShapes and upFractal and not showLeadingOnly
    label.new(bar_index - n,
             rsi_high[n] + sellOffsetTicks + 4, "▼",
             xloc=xloc.bar_index, yloc=yloc.price,
             style=label.style_none,
             color=color.new(color.white, 100),
             textcolor=#FF0000, size=size.large,
             tooltip="Fractal Sell (Confirmed)")

if showShapes and downFractal and not showLeadingOnly
    label.new(bar_index - n,
             rsi_low[n] - buyOffsetTicks - 4, "▲",
             xloc=xloc.bar_index, yloc=yloc.price,
             style=label.style_none,
             color=color.new(color.white, 100),
             textcolor=#00FF00, size=size.large,
             tooltip="Fractal Buy (Confirmed)")

// =================================================================
// LEADING SIGNAL LABELS (1 bar earlier, at current bar)
// =================================================================
if showLabels and leadingBuyFinal
    label.new(bar_index,
             rsi_low - buyOffsetTicks, "LEAD\nBUY",
             xloc=xloc.bar_index, yloc=yloc.price,
             style=label.style_label_up,
             color=leadingLabelBgColorBuy, textcolor=color.black,
             size=lblSize)

if showLabels and leadingSellFinal
    label.new(bar_index,
             rsi_high + sellOffsetTicks, "LEAD\nSELL",
             xloc=xloc.bar_index, yloc=yloc.price,
             style=label.style_label_down,
             color=leadingLabelBgColorSell, textcolor=color.white,
             size=lblSize)

// Leading signal shapes
if showShapes and leadingBuyFinal
    label.new(bar_index,
             rsi_low - buyOffsetTicks - 6, "⚡",
             xloc=xloc.bar_index, yloc=yloc.price,
             style=label.style_none,
             color=color.new(color.white, 100),
             textcolor=leadingLabelBgColorBuy, size=size.large,
             tooltip="Leading BUY - 1 bar early")

if showShapes and leadingSellFinal
    label.new(bar_index,
             rsi_high + sellOffsetTicks + 6, "⚡",
             xloc=xloc.bar_index, yloc=yloc.price,
             style=label.style_none,
             color=color.new(color.white, 100),
             textcolor=leadingLabelBgColorSell, size=size.large,
             tooltip="Leading SELL - 1 bar early")

barcolor(colorBars ? grad_color : na, title="Bar Color")

// =================================================================
// Information Table
// =================================================================
var table infoTable = table.new(position.top_left, 2, 5,
                                bgcolor=color.new(#1E1E1E, 10),
                                frame_color=color.new(#00FF00, 50),
                                frame_width=1,
                                border_width=1,
                                border_color=color.new(#444444, 70))

if barstate.islast
    table.cell(infoTable, 0, 0, "RSI Cheby Pro v2",
               text_color=color.new(#00FF00, 0),
               text_size=size.small,
               bgcolor=color.new(#0A0A0A, 0))
    table.cell(infoTable, 1, 0, "LEADING",
               text_color=color.new(#00E676, 0),
               text_size=size.small,
               bgcolor=color.new(#0A0A0A, 0))

    table.cell(infoTable, 0, 1, "Leading Signals:",
               text_color=color.white,
               text_size=size.tiny,
               bgcolor=color.new(#1E1E1E, 0))
    table.cell(infoTable, 1, 1, enableLeadingSignals ? "ON" : "OFF",
               text_color=enableLeadingSignals ? color.yellow : color.gray,
               text_size=size.tiny,
               bgcolor=color.new(#1E1E1E, 0))

    table.cell(infoTable, 0, 2, "OB/OS Zones:",
               text_color=color.white,
               text_size=size.tiny,
               bgcolor=color.new(#1E1E1E, 0))
    table.cell(infoTable, 1, 2, str.tostring(leadingOverbought) + "/" + str.tostring(leadingOversold),
               text_color=color.aqua,
               text_size=size.tiny,
               bgcolor=color.new(#1E1E1E, 0))

    table.cell(infoTable, 0, 3, "Reversal Candle:",
               text_color=color.white,
               text_size=size.tiny,
               bgcolor=color.new(#1E1E1E, 0))
    table.cell(infoTable, 1, 3, requireReversalCandle ? "REQ" : "OPT",
               text_color=requireReversalCandle ? color.orange : color.gray,
               text_size=size.tiny,
               bgcolor=color.new(#1E1E1E, 0))

    table.cell(infoTable, 0, 4, "RSI:",
               text_color=color.white,
               text_size=size.tiny,
               bgcolor=color.new(#1E1E1E, 0))
    rsiColor = rsi_close < leadingOversold ? color.green : rsi_close > leadingOverbought ? color.red : color.gray
    table.cell(infoTable, 1, 4, str.tostring(rsi_close, "#.#"),
               text_color=rsiColor,
               text_size=size.tiny,
               bgcolor=color.new(#1E1E1E, 0))

// =================================================================
// Alert Conditions
// =================================================================
// Standard (confirmed) alerts
alertcondition(downFractal, title="Fractal BUY Signal (Confirmed)",
               message="RSI Chebyshev: Confirmed Fractal BUY")

alertcondition(upFractal, title="Fractal SELL Signal (Confirmed)",
               message="RSI Chebyshev: Confirmed Fractal SELL")

// Leading alerts (1 bar earlier)
alertcondition(leadingBuyFinal, title="LEADING BUY Signal (1 Bar Early)",
               message="RSI Chebyshev: LEADING BUY - Potential reversal detected 1 bar early!")

alertcondition(leadingSellFinal, title="LEADING SELL Signal (1 Bar Early)",
               message="RSI Chebyshev: LEADING SELL - Potential reversal detected 1 bar early!")

// Combined alerts
alertcondition(leadingBuyFinal or downFractal, title="Any BUY Signal",
               message="RSI Chebyshev: BUY Signal (Leading or Confirmed)")

alertcondition(leadingSellFinal or upFractal, title="Any SELL Signal",
               message="RSI Chebyshev: SELL Signal (Leading or Confirmed)")

// Pattern alerts
alertcondition(engulfing_bullish, title="Engulfing Bullish",
               message="RSI Chebyshev: Engulfing Bullish confirmed")

alertcondition(engulfing_bearish, title="Engulfing Bearish",
               message="RSI Chebyshev: Engulfing Bearish confirmed")

alertcondition(morning_star_bullish, title="Morning Star Bullish",
               message="RSI Chebyshev: Morning Star Bullish confirmed")

alertcondition(evening_star_bearish, title="Evening Star Bearish",
               message="RSI Chebyshev: Evening Star Bearish confirmed")
